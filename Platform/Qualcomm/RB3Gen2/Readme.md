Support for Qualcomm Dragonwing RB3 Gen 2 platform is available in this directory.

# How to build (Linux Environment)

## Prerequisites
The build tools themselves depend on Python (3), acpica-tools and libuuid. Most
Linux systems will come with a Python environment installed by default, but you
usually need to install uuid-dev (or uuid-devel, depending on distribution) and
acpica-tools manually.

## If cross compiling
If building EDK2 for a different archtecture than the build machine, you need to
obtain an appropriate cross-compiler.

Target architecture | Cross compilation prefix
--------------------|-------------------------
AARCH64             | aarch64-linux-gnu-

### GCC
Arm provides GCC toolchains for aarch64-linux-gnu and arm-linux-gnueabihf at
[Arm GNU Toolchain](https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads)
compiled to run on x86_64/i686 Linux and i686 Windows. Some Linux distributions
provide their own packaged cross-toolchains.

## Obtaining source code
1. Create a new folder (directory) on your local development machine
   for use as your workspace. This example uses `/work/git/tianocore`, modify as
   appropriate for your needs.
   ```
   $ export WORKSPACE=/work/git/tianocore
   $ mkdir -p $WORKSPACE
   $ cd $WORKSPACE
   ```

2. Into that folder, clone:
   1. [edk2](https://github.com/tianocore/edk2)
   2. [edk2-platforms](https://github.com/tianocore/edk2-platforms)
   ```
   $ git clone https://github.com/tianocore/edk2.git
   $ cd edk2 && git submodule update --init && cd $WORKSPACE
   ...
   $ git clone https://github.com/tianocore/edk2-platforms.git
   $ cd edk2-platforms && git submodule update --init && cd $WORKSPACE
   ```

3. Set up a **PACKAGES_PATH** to point to the locations of these three
   repositories:

   `$ export PACKAGES_PATH=$PWD/edk2:$PWD/edk2-platforms`

## Manual building

1. Set up the build environment (this will modify your environment variables)

   `$ . edk2/edksetup.sh`

   (This step _depends_ on **WORKSPACE** being set as per above.)

2. Build BaseTools

   `make -C edk2/BaseTools`

### Build for RB3Gen2 platform
```
$ build -b RELEASE -a AARCH64 -t GCC -p Platform/Qualcomm/RB3Gen2/RB3Gen2.dsc
```

#### If cross-compiling
When cross-compiling, we additionally need to inform the build command which
toolchain to use. We do this by setting the environment variable
`{TOOL_CHAIN_TAG}_{TARGET_ARCH}_PREFIX` - in the case above,
**GCC_AARCH64_PREFIX**.

So, referring to the cross compiler toolchain table above, we should prepend
the `build` command line with `GCC_AARCH64_PREFIX=aarch64-linux-gnu-`.

### ELF payload generation for RB3Gen2 platform

Create an ELF payload as expected by Qualcomm early stage proprietary boot-loader
XBL:
```
$ cd $WORKSPACE
$ ./edk2-platforms/Platform/Qualcomm/RB3Gen2/RB3Gen2-generate-elf.sh RELEASE
```
Note that this shell script uses [qtestsign](https://github.com/msm8916-mainline/qtestsign)
to add a dummy signature/certificate chain. For production builds, you need to
use Qualcomm's own signing tool which isn't publicly available.

Build output: $WORKSPACE/uefi.elf

# How to flash RB3Gen2 (Linux Environment)

Generate a Yocto BSP image for RB3Gen2 following instructions from meta-qcom
[here](https://github.com/qualcomm-linux/meta-qcom?tab=readme-ov-file#quick-build).

It will generate a tar ball in the build folder for RB3Gen2 something like:
`qcom-multimedia-image-qcs6490-rb3gen2-core-kit.rootfs.qcomflash.tar.gz`. Untar it
and replace `uefi.elf` with the one you have generated by yourself.

Then flash the board following the meta-qcom instructions
[here](https://github.com/qualcomm-linux/meta-qcom?tab=readme-ov-file#flash-images).
